<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Showcase - ParticleBox</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/showcase.css">
    <link rel="icon" type="image/png" href="icon.png">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://kit.fontawesome.com/ca7f2ffa51.js" crossorigin="anonymous"></script>
</head>
<body>
    <div class="navbar">
        <div class="logo">
          <a href="index.html" class="icon">
            <img src="icon.png" height="27px" width="27px" alt="Logo">
          </a>
        </div>
        <a href="index.html" class="nav-text">Home</a>
        <a href="#overview" class="nav-text">Overview</a>
        <a href="#gallery" class="nav-text">Gallery</a>
        <a href="#background" class="nav-text">Background</a>
        <a href="#implementation" class="nav-text">Implementation</a>
        <a href="#performance" class="nav-text">Performance</a>
      </div>
    <div class="showcase__hero">
        <div class="showcase__wrapper">
            <div class="project-card">
                <div class="project-card__header">
                    <div class="project-card__header-left">
                        <h1 class="project-title">ParticleBox</h1>
                        <div class="project-meta">
                            <span class="project-language">C++17 | SDL2</span>
                            <span class="project-license">MIT License</span>
                        </div>
                    </div>
                    <div class="project-card__header-right">
                        <div class="project-stats">
                            <div class="stat-item">
                                <i class="fas fa-star"></i>
                                <span class="stat-count stars-count">128</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-code-branch"></i>
                                <span class="stat-count forks-count">24</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-eye"></i>
                                <span class="stat-count watchers-count">76</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="project-card__body">
                    <p class="project-description">A high-performance, multithreaded particle physics simulator built from the ground up to demonstrate modern C++ optimization techniques and data structure mastery.</p>
                </div>
                <div class="project-updated">
                    <span>Updated <span class="updated-date">March 2025</span></span>
                </div>
            </div>
        </div>
    </div>

    <div style="text-align: center; font-size: 2rem; margin: 20px 0;">
        <span>&#8226;</span>
        <span>&#8226;</span>
        <span>&#8226;</span>
    </div>

    <div class="showcase__content">
        <section id="overview" class="showcase__section">
            <h2>Overview</h2>
            <p>ParticleBox is a high-performance C++ particle simulator designed to demonstrate cutting-edge optimization techniques for real-time physics simulations.</p>
            
            <p>To achieve exceptional performance, ParticleBox implements:</p>
            <ul>
                <li><strong>Spatial Partitioning:</strong> Grid-based collision detection reducing complexity from O(nÂ²) to O(n), enabling the simulation of magnitudes more particles than naive approaches.</li>
                <li><strong>Multithreaded Processing:</strong> Parallel computation using hardware-aware threading with optimizations for specific architectures including Apple Silicon.</li>
                <li><strong>SIMD Vector Operations:</strong> Leveraging CPU vector instructions for processing multiple particles simultaneously.</li>
                <li><strong>Cache-Optimized Data Structures:</strong> Memory-aligned contiguous particle storage with minimal cache misses, using structure-of-arrays design for maximum throughput.</li>
            </ul>
            
            <h3>Technical Highlights</h3>
            <ul>
                <li><strong>Zero-Overhead Abstractions:</strong> Leveraging C++ template metaprogramming and compile-time optimizations to create high-level abstractions with no runtime cost.</li>
                <li><strong>Advanced Math Optimizations:</strong> Fast inverse square root algorithm and bitwise operations for maximum computation efficiency.</li>
                <li><strong>Data-Oriented Design:</strong> Optimized memory layouts prioritizing access patterns over object hierarchies.</li>
                <li><strong>Zero-Allocation Runtime:</strong> Core simulation loop runs without heap allocations to eliminate garbage collection pauses.</li>
            </ul>
        </section>

        <section id="gallery" class="showcase__section">
            <h2>Gallery</h2>
            <div class="image-gallery">
                <img src="images/p2.png" alt="Particle simulation screenshot displaying spatial distribution patterns">
                <img src="images/p1.gif" alt="Particle simulation screenshot displaying spatial distribution patterns">
            </div>
        </section>
    
        <section id="background" class="showcase__section">
            <h2>Background</h2>
            
            <h3>Mathematical Foundation</h3>
            <p>ParticleBox implements an optimized physics simulation using numerically stable algorithms. The core mathematical concepts include:</p>
            
            <h4>Collision Detection Mathematics</h4>
            <p>For colliding particles, the distance \(d\) between particles is computed using SIMD-optimized vector operations:</p>
            <p>
                \[
                d = \sqrt{(p2.x - p1.x)^2 + (p2.y - p1.y)^2}
                \]
            </p>
            <p>A collision occurs when \(d < (r1 + r2)\), where \(r1\) and \(r2\) are the radii of the particles. This calculation avoids costly square root operations by comparing squared distances in the inner loop, using the Fast Inverse Square Root algorithm when needed.</p>
            
            <h4>Force Calculation</h4>
            <p>The repulsion force magnitude \(F_r\) between overlapping particles is given by:</p>
            <p>
                \[
                F_r = k_{rep} \cdot \delta
                \]
            </p>
            <p>Where \(\delta\) is the overlap distance \((r1 + r2) - d\), and \(k_{rep}\) is the repulsion strength constant. Force calculations are SIMD-vectorized for cache efficiency.</p>
            
            <h4>Integration Method</h4>
            <p>The simulation uses Verlet integration for better numerical stability and performance:</p>
            <p>
                \[
                \mathbf{p}_{t+\Delta t} = 2\mathbf{p}_t - \mathbf{p}_{t-\Delta t} + \mathbf{a}_t \cdot \Delta t^2
                \]
            </p>
            <p>This integration method provides better energy conservation and stability compared to traditional Euler integration, especially for particle systems.</p>
        </section>
        
        <section id="implementation" class="showcase__section">
            <h2>Implementation</h2>
            
            <h3>System Architecture</h3>
            <p>ParticleBox follows a data-oriented architecture with clear separation of concerns to maximize parallelizability and cache efficiency:</p>
            <ul>
                <li><strong>Core Simulation Loop:</strong> Lock-free, zero-allocation update cycle optimized for cache coherence and SIMD operations.</li>
                <li><strong>Spatial Partitioning System:</strong> Grid-based partitioning with optimized cell lookups using bit-shifting operations for O(1) cell access.</li>
                <li><strong>Parallel Processing Framework:</strong> Dynamically adapts to available hardware cores with platform-specific optimizations.</li>
                <li><strong>Rendering Pipeline:</strong> Decoupled from physics using double-buffering to prevent thread contention with memory pooling for particle textures.</li>
                <li><strong>Memory Manager:</strong> Custom allocator for particle data with pre-allocation strategies that eliminate fragmentation.</li>
            </ul>
            
            <h3>Spatial Partitioning</h3>
            <p>The spatial partitioning system is implemented using a fixed-grid approach with significant optimizations:</p>
            <ul>
                <li><strong>Optimized Cell Lookups:</strong> Using bit-shifting (>> CELL_SIZE_SHIFT) for fast cell index calculations.</li>
                <li><strong>Adjacent Cell Checking:</strong> Only checking nearby grid cells (up to 9 cells) for potential collisions.</li>
                <li><strong>Flat Arrays:</strong> Using flat vectors instead of nested containers for better cache locality when iterating through cells.</li>
                <li><strong>Pre-computed Cell Assignments:</strong> Batch updating of cell assignments to minimize memory thrashing.</li>
            </ul>
            
            <h3>Multithreaded Physics Engine</h3>
            <p>The physics engine divides computation across available CPU cores using a sophisticated work distribution system:</p>
            <ul>
                <li><strong>Parallel Particle Updates:</strong> Divides particles into chunks processed by multiple threads.</li>
                <li><strong>Hardware Detection:</strong> Automatically detects available CPU cores for optimal thread count selection.</li>
                <li><strong>Apple-specific Optimizations:</strong> Uses Grand Central Dispatch for optimal M1/M2 performance.</li>
                <li><strong>OpenMP Directives:</strong> Used for cross-platform parallelization with #pragma omp.</li>
                <li><strong>Thread-local Storage:</strong> Per-thread data structures to eliminate contention and false sharing.</li>
            </ul>
            
            <h3>SIMD Optimizations</h3>
            <p>Vector operations are heavily optimized using SIMD instructions:</p>
            <ul>
                <li><strong>Vector Operations:</strong> Uses SIMD instructions for processing multiple particles simultaneously.</li>
                <li><strong>Platform Detection:</strong> Automatically detects and uses platform-specific SIMD capabilities (AVX2, SSE4, NEON).</li>
                <li><strong>Apple Silicon:</strong> Special optimizations for Apple M1/M2 processors using simd_float2 native types.</li>
                <li><strong>Batch Processing:</strong> Organizes particle data to enable efficient SIMD register usage.</li>
            </ul>
            
            <h3>Memory Optimizations</h3>
            <p>Memory access patterns have been meticulously optimized for modern CPU architectures:</p>
            <ul>
                <li><strong>Pre-allocation:</strong> Pre-allocates particle storage with reserve() to avoid reallocations during simulation.</li>
                <li><strong>Memory Locality:</strong> Uses contiguous arrays for better cache performance.</li>
                <li><strong>Thread-local RNGs:</strong> Uses thread-local random number generators to avoid contention.</li>
                <li><strong>Memory Pooling:</strong> Texture caching for particle rendering to reduce GPU memory transfers.</li>
                <li><strong>Structure of Arrays (SoA):</strong> Reorganized particle data in SoA format for better SIMD utilization.</li>
            </ul>
            
            <h3>Math Optimizations</h3>
            <p>Several mathematical optimizations provide significant performance gains:</p>
            <ul>
                <li><strong>Fast Inverse Square Root:</strong> Implements the Quake III fast inverse square root algorithm for distance calculations.</li>
                <li><strong>Multiplication over Division:</strong> Using multiplication by inverse instead of division when possible.</li>
                <li><strong>Bitwise Operations:</strong> Using fast bit-shifting operations for calculations and grid lookups.</li>
                <li><strong>Early Exits:</strong> Avoiding unnecessary calculations when particles are far apart using distance threshold checks.</li>
            </ul>
        </section>
        
        <section id="performance" class="showcase__section">
            <h2>Performance Optimization</h2>
            
            <h3>Multithreading Implementation</h3>
            <p>ParticleBox achieves near-linear scaling with CPU cores through careful workload balancing and contention avoidance:</p>
            <ul>
                <li><strong>Dynamic Thread Count Detection:</strong> Automatically scales to available hardware using hardware concurrency detection.</li>
                <li><strong>Lock-Free Synchronization:</strong> Uses atomic operations and careful task division to minimize thread synchronization overhead.</li>
                <li><strong>Parallel Random Number Generation:</strong> Thread-local state prevents contention for particle generation.</li>
            </ul>
            
            <h3>Memory Optimization Techniques</h3>
            <p>Memory access patterns have been meticulously optimized for modern CPU architectures:</p>
            <ul>
                <li><strong>Pre-allocation Strategy:</strong> All vectors reserve capacity upfront to eliminate reallocation costs during simulation.</li>
                <li><strong>Memory Alignment:</strong> Data structures aligned to cache line boundaries to prevent false sharing between threads.</li>
                <li><strong>Custom Memory Pool:</strong> Specialized allocator for particle data that eliminates fragmentation and improves locality.</li>
            </ul>
            
            <h3>Profiling-Driven Optimizations</h3>
            <p>Performance bottlenecks were identified and addressed using comprehensive profiling tools:</p>
            <ul>
                <li><strong>Hotspot Analysis:</strong> Used Valgrind to identify critical areas for optimization.</li>
                <li><strong>Memory Bandwidth:</strong> Reduced memory traffic by over 90% through better data locality and compact structures.</li>
            </ul>
        </section>

        <section id="tech-stack" class="showcase__section">
            <h2>Technology Stack</h2>
            <div class="tech-icons">
                <img src="https://upload.wikimedia.org/wikipedia/commons/1/18/ISO_C%2B%2B_Logo.svg" alt="C++ Logo" title="C++" class="icon">
            </div>
            <ul>
                <li><strong>Core Language:</strong> C++17</li>
                <li><strong>Graphics API:</strong> SDL2</li>
                <li><strong>Build System:</strong> CMake with platform-specific optimization flags</li>
                <li><strong>Optimization Techniques:</strong> Spatial partitioning, SIMD, Multithreading, Memory layout optimization</li>
                <li><strong>Profiling Tools:</strong> Valgrind, Intel VTune, Apple Instruments</li>
                <li><strong>Development Environment:</strong> Visual Studio Code, CLion</li>
                <li><strong>Platform Support:</strong> Windows, macOS, Linux with platform-specific optimizations</li>
            </ul>
        </section>
    </div>
    <footer class="footer">
        <div class="footer__container">
          <div class="footer__content">
            <div class="footer__logo">
              <img src="icon.png" height="22px" width="22px" alt="Aaron McLean Logo">
              <h3>aaronmclean.xyz</h3>
            </div>
          </div>
          <div class="footer__copyright">
            <p>&copy; <span id="current-year"></span> Aaron McLean</p>
          </div>
        </div>
      </footer>
    <div class="fullscreen-viewer">
        <img src="" alt="Fullscreen image" class="fullscreen-image">
        <div class="fullscreen-nav">
            <button class="fullscreen-prev">
                <i class="fas fa-chevron-left"></i>
              </button>
              <button class="fullscreen-next">
                <i class="fas fa-chevron-right"></i>
              </button>
        </div>
        <button class="fullscreen-close">&times;</button>
    </div>

    <script src="js/photo.js"></script>
    <script src="js/showcase.js"></script>
    <script src="js/github.js"></script>
    <script src="js/track.js"></script>
</body>
</html>